<?xml version="1.0"?>
<launch>

	<!-- SUMMIT XL STEEL-->
	<!-- disables gazebo ros_control plugin -->
	<arg name="ros_planar_move_plugin" default="true"/>

  <!-- By default, we are not in debug mode -->
  <arg name="debug" default="false" />  
	<arg name="launch_rviz" default="true"/>
	<arg name="gazebo_world" default="$(find icclab_summit_xl)/worlds/summit_xl_office.world"/>

	<!-- <arg name="map_file_a" default="icclab/icclab_latest_map.yaml"/> -->
	<arg name="map_file_a" default="willow_garage/willow_garage.yaml"/>
	<arg name="localization_robot_a" default="false"/>
	<arg name="gmapping_robot_a" default="false"/>
	<arg name="move_base_robot_a" default="true"/>
	<arg name="amcl_and_mapserver_a" default="true"/>
	<arg name="xacro_robot_a" default="irlab_summit_xls_std.urdf.xacro"/>
	<arg name="enable_arm" default="false"/>

	<include file="$(find icclab_summit_xl)/launch/sim/irlab_summit_xl_gazebo.launch">
		<!-- general args -->
		<arg name="launch_rviz" value="$(arg launch_rviz)"/>
		<arg name="gazebo_world" value="$(arg gazebo_world)"/>
		<arg name="ros_planar_move_plugin" value="$(arg ros_planar_move_plugin)"/>
		<!-- robot args -->
		<arg name="map_file_a" value="$(arg map_file_a)"/>
		<arg name="localization_robot_a" value="$(arg localization_robot_a)"/>
		<arg name="gmapping_robot_a" value="$(arg gmapping_robot_a)"/>
		<arg name="move_base_robot_a" value="$(arg move_base_robot_a)"/>
		<arg name="amcl_and_mapserver_a" value="$(arg amcl_and_mapserver_a)"/>
		<arg name="xacro_robot_a" value="$(arg xacro_robot_a)"/>
	</include>
	
	
  <arg name="id_robot" default="summit_xl"/>
	<group if="$(arg enable_arm)" ns="$(arg id_robot)">

    <!-- Load the URDF, SRDF and other .yaml configuration files on the param server -->
    <include file="$(find icclab_summit_xl)/launch/sim/planning_context.launch">
      <arg name="load_robot_description" value="true"/>
    </include>
<!--    <include file="$(find robotnik_ur5_moveit_config)/launch/planning_context.launch">-->
<!--      <arg name="load_robot_description" value="true"/>-->
<!--    </include>-->

    <!-- Run the main MoveIt executable without trajectory execution (we do not have controllers configured by default) -->
    <include file="$(find icclab_summit_xl)/launch/move_group.launch">
      <arg name="allow_trajectory_execution" value="true"/>
      <arg name="fake_execution" value="false"/>
      <arg name="info" value="true"/>
      <arg name="debug" value="$(arg debug)"/>
    </include>

    <!-- Controller parameters-->   
    <rosparam file="$(find robotnik_ur5_moveit_config)/config/controllers.yaml"/> 

    <!-- run point cloud filtering--> 
    <node name="pointcloud_filtering" pkg="irlab_point_cloud_filtering" type="point_cloud_filtering_server" respawn="false" args="/summit_xl/arm_camera/depth_registered/points" output="screen"/>

   <!-- import octomap sensors -->
    <include ns="move_group"  file="$(find icclab_summit_xl)/launch/include/sensor_manager.launch.xml"/>
    
    <!-- Run Rviz and load the default config to see the state of the move_group node -->
     <arg name="command_args" value="-d $(find icclab_summit_xl)/rviz/grasping.rviz" />
     <node name="rviz_grasping" pkg="rviz" type="rviz" args="$(arg command_args)" respawn="false" output="screen">
      <rosparam command="load" file="$(find robotnik_ur5_moveit_config)/config/kinematics.yaml"/>
    </node>
    
  </group>
  
  <!-- run grasp detection -->
  <include if="$(arg enable_arm)" file="$(find gpd)/launch/grasp_generation.launch"/>

</launch>
